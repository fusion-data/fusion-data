# 各开源协议比较

- [AGPL](#agpl)
- [MPL 2.0](#mpl-20)

## AGPL

使用 AGPL 3（Affero 通用公共许可证第三版）协议的开源库进行商业软件开发时，需特别注意其严格的“传染性”条款。以下是关键注意事项：

---

### **1. AGPL 的核心要求**

- **网络服务触发开源义务**：
  如果软件通过网络提供服务（如 SaaS），即使未分发软件本身，任何基于 AGPL 库的修改或衍生代码（包括直接链接的代码）**必须向用户开放源代码**。
- **代码公开范围**：
  若软件与 AGPL 库存在“密切结合”（如静态链接、直接调用），整个衍生作品可能需遵循 AGPL 协议，导致专有代码被迫开源。

---

### **2. 避免传染性的策略**

- **隔离架构**：
  将 AGPL 库与核心业务代码隔离，通过 API、RPC、独立服务或动态链接（需谨慎）等方式交互。确保两者不构成“单一程序”（法律上的衍生作品）。
- **明确边界**：
  避免直接修改 AGPL 库代码，否则修改部分必须开源。若必须修改，需独立维护并遵守 AGPL 要求。

---

### **3. 许可证兼容性检查**

- **依赖库兼容性**：
  确认项目中其他依赖库的许可证（如 GPL、MIT、Apache）是否与 AGPL 兼容。例如，GPLv2 与 AGPLv3 不兼容，混合使用可能导致法律冲突。
- **商业代码闭源性**：
  若需保留部分代码闭源，需确保其与 AGPL 代码的交互符合隔离要求，避免被认定为衍生作品。

---

### **4. 分发与用户权利**

- **源代码提供义务**：
  若分发软件（如交付客户端），必须向用户提供完整的 AGPL 相关源代码，包括修改记录和构建说明。
- **明确声明与通知**：
  在软件文档、UI 或登录页面中注明 AGPL 组件的使用，并提供获取源代码的途径（如代码仓库链接）。

---

### **5. 法律与合规风险**

- **侵权风险**：
  违反 AGPL 可能导致版权方起诉，要求赔偿或强制开源代码。典型案例包括 Neovim 社区与 Elastic 公司的争议。
- **法律审查**：
  建议由专业律师审查代码架构和许可证合规性，尤其关注代码交互是否构成“衍生作品”。

---

### **6. 替代方案与商业授权**

- **替换非传染性协议库**：
  优先选择 MIT、Apache 或 LGPL 等更宽松协议的库。
- **商业授权谈判**：
  联系 AGPL 库作者购买商业许可，获得闭源豁免权（如 MongoDB 的 SSPL 协议商业版本）。

---

### **总结建议**

- **架构设计先行**：在项目初期规划代码隔离方案。
- **自动化合规检查**：使用工具（如 FOSSology）扫描依赖库的许可证。
- **法律咨询**：确保合规性，避免潜在诉讼。

AGPL 的设计初衷是促进开源协作，但对商业闭源软件可能构成挑战。谨慎评估风险，必要时寻求法律与技术双重保障。

## MPL 2.0

使用 **Mozilla Public License 2.0（MPL 2.0）** 协议的开源库进行商业软件开发时，其条款比 AGPL 宽松，但仍需注意以下关键事项：

---

### **1. 核心规则与“弱传染性”**

- **文件级开源义务**：
  MPL 2.0 是“弱传染性”协议，其传染性仅作用于**单个文件**级别。

  - **直接修改 MPL 文件**：若修改了 MPL 协议的源代码文件，必须开源这些文件的修改版本。
  - **新增文件可闭源**：项目中新增的文件（与 MPL 文件无直接依赖）可以保持闭源。

- **允许与闭源代码混合**：
  闭源代码与 MPL 代码可以共存于同一项目中，甚至通过接口调用，只要不直接修改或衍生 MPL 文件。

---

### **2. 分发或部署时的义务**

- **提供源代码**：
  **若分发软件（如交付给客户或部署到用户设备）**，必须向接收者提供项目中所有 MPL 协议文件的源代码（包括修改后的版本）。

  - 可通过附加文档、代码托管平台链接或物理媒介提供。
  - **仅网络服务（SaaS）无需开源**：如果软件仅通过云端提供服务（不向用户分发软件），则无需公开代码。

- **保留声明与版权信息**：
  不得删除 MPL 文件中原有的版权声明、许可证文本或免责条款。

---

### **3. 许可证兼容性**

- **与 GPL 的兼容性**：
  MPL 2.0 允许将 MPL 代码与 GPLv2/GPLv3 代码结合，但结合后的整体代码需遵循 GPL 协议（需谨慎评估是否接受 GPL 的强传染性）。
- **与 Apache/MIT 的兼容性**：
  MPL 2.0 与 Apache 2.0、MIT 等宽松协议兼容，可混合使用。

---

### **4. 专利授权条款**

- **贡献者专利授权**：
  MPL 2.0 包含明确的专利授权条款。若使用 MPL 代码，贡献者将授予用户其相关专利的使用权。
- **专利诉讼限制**：
  若发起专利诉讼指控 MPL 代码侵权，则自动丧失 MPL 授予的专利权利。

---

### **5. 商业闭源策略**

- **代码隔离设计**：
  - 将 MPL 代码与闭源代码存放在不同文件中，避免直接修改 MPL 文件。
  - 通过 API、消息队列或动态链接库（DLL/SO）等方式调用 MPL 代码，确保不构成“衍生作品”。
- **选择性开源**：
  若需修改 MPL 文件，可仅公开修改后的 MPL 文件，其余代码保持闭源。

---

### **6. 法律与合规检查**

- **明确代码边界**：
  确保 MPL 文件与闭源文件的交互方式符合“弱传染性”要求（例如，避免闭源代码直接依赖 MPL 代码的内部数据结构）。
- **依赖扫描工具**：
  使用工具（如 FOSSology、ScanCode）检查所有依赖库的许可证，避免与 MPL 2.0 冲突。
- **法律审查**：
  复杂场景建议由律师审核架构设计和代码分发方式。

---

### **7. 替代方案与商业授权**

- **替换更宽松协议库**：
  若希望完全闭源，可优先选择 MIT、BSD 或 Apache 2.0 协议的库。
- **商业授权谈判**：
  若必须使用 MPL 库且希望闭源修改后的代码，可联系作者购买商业授权（如有提供）。

---

### **总结建议**

- **优势**：MPL 2.0 适合希望混合开源与闭源代码的商业项目，尤其是需要保护核心业务逻辑的场景。
- **风险控制**：
  - 分发软件时，确保提供 MPL 文件的源代码。
  - 避免直接修改 MPL 文件，或接受其开源义务。
  - 保留所有原始声明，避免专利纠纷。

MPL 2.0 在灵活性与合规成本之间取得了较好的平衡，但仍需严格区分开源与闭源文件的界限。
